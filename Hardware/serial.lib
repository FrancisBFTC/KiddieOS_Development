; ===================================================
; KiddieOS - Serial Driver Library
; Created by Francis
; Version 1.0.0
; ===================================================

%IFNDEF _SERIAL_LIB_
%DEFINE _SERIAL_LIB_

%DEFINE SERIAL_COM1  0x3F8
%DEFINE SERIAL_COM2  0x2F8
%DEFINE SERIAL_COM3  0x3E8
%DEFINE SERIAL_COM4  0x2E8

%DEFINE FIFO_Config  11000111b
%DEFINE BAUD_RATE    0x80    ;10000000b
%DEFINE DIVISOR      0x03      ;0x03
%DEFINE NO_PARITY    00000011b
%DEFINE IRQ_DISABLE  00000000b
%DEFINE IRQ_ENABLE   00001011b
%DEFINE DR           00000001b
%DEFINE THRE         00100000b

%DEFINE SERIAL_PORT  SERIAL_COM3
%DEFINE SERIAL_INSTALL  SERIAL
%DEFINE SERIAL_HANDLER  SERIAL+2
%DEFINE SERIAL_DATA     SERIAL+4

%DEFINE FIFO_PORT    SERIAL_PORT+2
%DEFINE LCR_PORT     SERIAL_PORT+3
%DEFINE IRQ_PORT     SERIAL_PORT+4
%DEFINE IRQ_PORT1    SERIAL_PORT+1
%DEFINE LSR_PORT 	 SERIAL_PORT+5
%DEFINE DIV_PORT     SERIAL_PORT+1
%DEFINE DIV_PORT1    SERIAL_PORT

SerialData db 0
StopRead   db 0

SerialStatus db 0 ; serial

%MACRO __Serial_Driver_Load 0
	mov BYTE[Sector], SERIAL_SECTOR
	mov BYTE[Drive], 80h
	mov BYTE[NumSectors], SERIAL_NUM_SECTORS
	mov WORD[SegmentAddr], 0800h
	mov WORD[OffsetAddr], SERIAL	
	call ReadDisk
%ENDMACRO

%ENDIF